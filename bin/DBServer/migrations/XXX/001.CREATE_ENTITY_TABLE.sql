USE machine;
CREATE TABLE IF NOT EXISTS `entitytype` (
  `Id` int(11) NOT NULL,
  `DisplayName` VARCHAR(500) NOT NULL,
  `IsManaged` BOOLEAN DEFAULT false,
  `ParentType` ENUM ('Profile','Tool','ToolRange','ToolHolder','ToolSubRangeBevel', 'ToolSubRangeTrueHole'
					, 'ToolRangeMarking', 'ProgramCode','ProgramItem','ProgramPiece'
					, 'Piece', 'StockItem', 'OperationType', 'ProductionRow'
					, 'Material', 'HandlingElement', 'OperationAdditionalItem') NOT NULL,
  `InternalCode` VARCHAR(50), 					
  `SecondaryKey` INT(11) NULL,  
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT COLLATE=utf8mb4_bin;

CREATE TABLE IF NOT EXISTS `entity` (
	`Id` INT(11) NOT NULL AUTO_INCREMENT,
	`DisplayName` VARCHAR(100) NOT NULL DEFAULT '',
	`EntityTypeId` INT(11) NOT NULL DEFAULT 0,
	`HashCode` CHAR(64)  NOT NULL,
	`SecondaryKey` INT(11) NULL,
	`Status` ENUM ('Available','Unavailable','Warning', 'Alarm', 'NoIconToDisplay', 'ToBeDeleted'
				, 'Original', 'ModifiedByCustomer'
				, 'ModifiedByFICEP', 'ToBeSkipped'
				, 'Empty', 'InProgress', 'Processed'
				, 'Executed', 'RQLoad', 'RQAck'
				, 'NotAvailable', 'Aborted', 'NotReady') NOT NULL,
	`Priority` INT NOT NULL DEFAULT 1,
	`CreatedBy` VARCHAR(32) NOT NULL DEFAULT 'MITROL',
	`CreatedOn` DATETIME NOT NULL DEFAULT current_timestamp(),
	`UpdatedBy` VARCHAR(32) NOT NULL DEFAULT 'MITROL',
	`UpdatedOn` DATETIME NOT NULL DEFAULT current_timestamp(),
	`RowVersion` TEXT NOT NULL,
	PRIMARY KEY (`Id`),
	FOREIGN KEY (EntityTypeId) REFERENCES entitytype(id),
	UNIQUE INDEX `IDX_Entity_DisplayName_SecondaryKey` (`DisplayName`, EntityTypeId, SecondaryKey) USING BTREE,
	INDEX `IDX_Entity_HashCode` (`HashCode`) USING BTREE	
) ENGINE=InnoDB DEFAULT COLLATE=utf8mb4_bin;


CREATE TABLE IF NOT EXISTS `entityLink` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `RelatedEntityHashCode` CHAR(64) NOT NULL,
  `EntityHashCode` CHAR(64) NOT NULL,
  `RelationType` ENUM('Child','ForeignKey', 'Sibling') NOT NULL COLLATE 'utf8mb4_bin',
  `RowNumber` INT(11) NOT NULL DEFAULT(1),
  `Level` INT(11) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT COLLATE=utf8mb4_bin;

REPLACE INTO entitytype
(DisplayName, Id, ParentType, SecondaryKey, InternalCode, IsManaged)
VALUES
('ProfileL', 1, 'Profile', NULL, NULL, false),
('ProfileV', 2, 'Profile', NULL, NULL, false),
('ProfileB', 3, 'Profile', NULL, NULL, false),
('ProfileI', 4, 'Profile', NULL, NULL, false),
('ProfileD', 5, 'Profile', NULL, NULL, false),
('ProfileT', 6, 'Profile', NULL, NULL, false),
('ProfileU', 7, 'Profile', NULL, NULL, false),
('ProfileQ', 8, 'Profile', NULL, NULL, false),
('ProfileC', 9, 'Profile', NULL, NULL, false),
('ProfileF', 11, 'Profile', NULL, NULL, false),
('ProfileN', 12, 'Profile', NULL, NULL, false),
('ProfileP', 13, 'Profile', NULL, NULL, false),
('ProfileR', 14, 'Profile', NULL, NULL, false),
('ToolTS15', 15, 'Tool', 8, 'PUNCH_15', false),
('ToolTS16', 16, 'Tool', 8, 'PUNCH_MK', false),
('ToolTS17', 17, 'Tool', 8, 'PUNCH_NOTCH', false),
('ToolTS18', 18, 'Tool', 8, 'PUNCH_18', false),
('ToolTS19', 19, 'Tool', 8, 'PUNCH_19', false),
('ToolTS20', 20, 'Tool', 8, 'PUNCH_POINT', false),
('ToolTS32', 32, 'Tool', 1, 'DRILL_32', false),
('ToolTS33', 33, 'Tool', 1, 'DRILL_33', false),
('ToolTS34', 34, 'Tool', 1, 'DEBURR', false),
('ToolTS35', 35, 'Tool', 1, 'FLARE', false),
('ToolTS36', 36, 'Tool', 1, 'DEBURR_36', false),
('ToolTS38', 38, 'Tool', 1, 'BORE', false),
('ToolTS39', 39, 'Tool', 1, 'POINT', false),
('ToolTS40', 40, 'Tool', 1, 'DRILL_40', false),
('ToolTS41', 41, 'Tool', 1, 'TAP', false),
('ToolTS50', 50, 'Tool', 16, 'SHEAR', false),
('ToolTS51', 51, 'Tool', 2, 'PLA', false),
('ToolTS52', 52, 'Tool', 4, 'OXY', false),
('ToolTS53', 53, 'Tool', 2, 'PLA_MK', false),
('ToolTS54', 54, 'Tool', 4, 'OXY_BEV', false),
('ToolTS55', 55, 'Tool', 512, 'DISC_BLADE', false),
('ToolTS56', 56, 'Tool', 512, 'BAND_BLADE', false),
('ToolTS57', 57, 'Tool', 1, 'ROTATING_BLADE', false),
('ToolTS61', 61, 'Tool', 1, 'MILL', false),
('ToolTS62', 62, 'Tool', 1, 'POCKET', false),
('ToolTS68', 68, 'Tool', 1, 'POCKET_68', false),
('ToolTS69', 69, 'Tool', 1, 'POCKET_69', false),
('ToolTS70', 70, 'Tool', 1, 'SENSE_70', false),
('ToolTS71', 71, 'Tool', 1, 'TAP_71', false),
('ToolTS73', 73, 'Tool', 1, 'DFLARE', false),
('ToolTS74', 74, 'Tool', 1, 'DEBURR', false),
('ToolTS75', 75, 'Tool', 1, 'POCKET_75', false),
('ToolTS76', 76, 'Tool', 1, 'POCKET_76', false),
('ToolTS77', 77, 'Tool', 1, 'PENCIL_77', false),
('ToolTS78', 78, 'Tool', 1, 'PENCIL_78', false),
('ToolTS79', 79, 'Tool', 1, 'PENCIL_79', false),
('ToolTS80', 80, 'Tool', 256, 'SENSE_80', false),
('ToolTS87', 86, 'Tool', 64, 'MARK_86', false),
('ToolTS87', 87, 'Tool', 64, 'MARK_87', false),
('ToolTS88', 88, 'Tool', 64, 'MARK_88', false),
('ToolTS89', 89, 'Tool', 32, 'MARK_JET', false),
('StockProfileL', 94, 'StockItem', NULL, NULL, false),
('StockProfileV', 95, 'StockItem', NULL, NULL, false),
('StockProfileB', 96, 'StockItem', NULL, NULL, false),
('StockProfileI', 97, 'StockItem', NULL, NULL, false),
('StockProfileD', 98, 'StockItem', NULL, NULL, false),
('StockProfileT', 99, 'StockItem', NULL, NULL, false),
('StockProfileU', 100, 'StockItem', NULL, NULL, false),
('StockProfileQ', 101, 'StockItem', NULL, NULL, false),
('StockProfileC', 102, 'StockItem', NULL, NULL, false),
('StockProfileF', 103, 'StockItem', NULL, NULL, false),
('StockProfileN', 104, 'StockItem', NULL, NULL, false),
('StockProfileP', 105, 'StockItem', NULL, NULL, false),
('StockProfileR', 106, 'StockItem', NULL, NULL, false),
('ToolHolder', 107, 'ToolHolder', NULL, NULL, false),
('PieceProfileL', 108, 'Piece', NULL, NULL, false),
('PieceProfileV', 109, 'Piece', NULL, NULL, false),
('PieceProfileB', 110, 'Piece', NULL, NULL, false),
('PieceProfileI', 111, 'Piece', NULL, NULL, false),
('PieceProfileD', 112, 'Piece', NULL, NULL, false),
('PieceProfileT', 113, 'Piece', NULL, NULL, false),
('PieceProfileU', 114, 'Piece', NULL, NULL, false),
('PieceProfileQ', 115, 'Piece', NULL, NULL, false),
('PieceProfileC', 116, 'Piece', NULL, NULL, false),
('PieceProfileF', 117, 'Piece', NULL, NULL, false),
('PieceProfileN', 118, 'Piece', NULL, NULL, false),
('PieceProfileP', 119, 'Piece', NULL, NULL, false),
('PieceProfileR', 120, 'Piece', NULL, NULL, false),
('ProgramPiece', 121, 'ProgramPiece', NULL, NULL, false),
('ProgramCode', 128, 'ProgramCode', NULL, NULL, false),
('ToolRangeTS32', 132, 'ToolRange', NULL, 'DRILL_32', false),
('ToolRangeTS33', 133, 'ToolRange', NULL, 'DRILL_33', false),
('ToolRangeTS34', 134, 'ToolRange', NULL, 'DEBURR', false),
('ToolRangeTS35', 135, 'ToolRange', NULL, 'FLARE', false),
('ToolRangeTS36', 136, 'ToolRange', NULL, 'DEBURR_36', false),
('ToolRangeTS38', 138, 'ToolRange', NULL, 'BORE', false),
('ToolRangeTS39', 139, 'ToolRange', NULL, 'POINT', false),
('ToolRangeTS40', 140, 'ToolRange', NULL, 'DRILL_40', false),
('ToolRangeTS41', 141, 'ToolRange', NULL, 'TAP', false),
('ToolRangeTS51', 151, 'ToolRange', NULL, 'PLA', false),
('ToolRangeTS52', 152, 'ToolRange', NULL, 'OXY', false),
('ToolRangeTS53', 153, 'ToolRange', NULL, 'PLA_MK',  false),
('ToolRangeTS54', 154, 'ToolRange', NULL, 'OXY_BEV', false),
('ToolRangeTS55', 155, 'ToolRange', NULL, 'DISC_BLADE', false),
('ToolRangeTS56', 156, 'ToolRange', NULL, 'BAND_BLADE', false),
('ToolRangeTS57', 157, 'ToolRange', NULL, 'ROTATING_BLADE', false),
('ToolRangeTS61', 161, 'ToolRange', NULL, 'MILL', false),
('ToolRangeTS62', 162, 'ToolRange', NULL, 'POCKET', false),
('ToolRangeTS68', 168, 'ToolRange', NULL, 'POCKET_68', false),
('ToolRangeTS69', 169, 'ToolRange', NULL, 'POCKET_69', false),
('ToolRangeTS70', 170, 'ToolRange', NULL, 'SENSE_70',  false),
('ToolRangeTS71', 171, 'ToolRange', NULL, 'TAP_71', false),
('ToolRangeTS73', 173, 'ToolRange', NULL, 'DFLARE', false),
('ToolRangeTS74', 174, 'ToolRange', NULL, 'DDEBURR', false),
('ToolRangeTS75', 175, 'ToolRange', NULL, 'POCKET_75', false),
('ToolRangeTS76', 176, 'ToolRange', NULL, 'POCKET_76', false),
('ToolRangeTS77', 177, 'ToolRange', NULL, 'PENCIL_77', false),
('ToolRangeTS78', 178, 'ToolRange', NULL, 'PENCIL_78', false),
('ToolRangeTS79', 179, 'ToolRange', NULL, 'POCKET_79',  false),
('ToolSubRangeBevelTS51', 184, 'ToolSubRangeBevel', NULL, 'PLA', false),
('ToolSubRangeBevelTS52', 185, 'ToolSubRangeBevel', NULL, 'OXY', false),
('ToolSubRangeBevelTS53', 186, 'ToolSubRangeBevel', NULL, 'PLA_MK', false),
('ToolSubRangeBevelTS54', 187, 'ToolSubRangeBevel', NULL, 'OXY_BEV', false),
('ToolSubRangeTrueHoleTS51', 188, 'ToolSubRangeTrueHole', NULL, 'PLA', false),
('ToolSubRangeTrueHoleTS53', 191,'ToolSubRangeTrueHole', NULL, 'PLA_MK', false),
('ToolRangeMarkingTS51', 194, 'ToolRangeMarking', NULL, 'PLA',  false),
('ToolRangeMarkingTS53', 196, 'ToolRangeMarking', NULL, 'PLA_MK',  false),
('ProgramProfileL', 198, 'ProgramItem', NULL, NULL, false),
('ProgramProfileV', 199, 'ProgramItem', NULL, NULL, false),
('ProgramProfileB', 200, 'ProgramItem', NULL, NULL, false),
('ProgramProfileI', 201, 'ProgramItem', NULL, NULL, false),
('ProgramProfileD', 202, 'ProgramItem', NULL, NULL, false),
('ProgramProfileT', 203, 'ProgramItem', NULL, NULL, false),
('ProgramProfileU', 204, 'ProgramItem', NULL, NULL, false),
('ProgramProfileQ', 205, 'ProgramItem', NULL, NULL, false),
('ProgramProfileC', 206, 'ProgramItem', NULL, NULL, false),
('ProgramProfileF', 207, 'ProgramItem', NULL, NULL, false),
('ProgramProfileN', 208, 'ProgramItem', NULL, NULL, false),
('ProgramProfileP', 209, 'ProgramItem', NULL, NULL, false),
('ProgramProfileR', 210, 'ProgramItem', NULL, NULL, false),
('ProductionRowProfileL', 211, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileV', 212, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileB', 213, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileI', 214, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileD', 215, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileT', 216, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileU', 217, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileQ', 218, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileC', 219, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileF', 220, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileN', 221, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileP', 222, 'ProductionRow', NULL, NULL, false),
('ProductionRowProfileR', 223, 'ProductionRow', NULL, NULL, false),
('OperationNode', 224, 'OperationType', NULL, NULL, false),
('OperationHol', 225, 'OperationType', NULL, NULL, false),
('OperationPoint', 226, 'OperationType', NULL, NULL, false),
('OperationSlot', 227, 'OperationType', NULL, NULL, false),
('OperationTap', 228, 'OperationType', NULL, NULL, false),
('OperationPathC', 229, 'OperationType', NULL, NULL, false),
('OperationDeburr', 230, 'OperationType', NULL, NULL, false),
('OperationBore', 231, 'OperationType', NULL, NULL, false),
('OperationFlare', 232, 'OperationType', NULL, NULL, false),
('OperationShape', 233, 'OperationType', NULL, NULL, false),
('OperationMill', 234, 'OperationType', NULL, NULL, false),
('OperationMCut', 235, 'OperationType', NULL, NULL, false),
('OperationNotch', 236, 'OperationType', NULL, NULL, false),
('OperationShf', 237, 'OperationType', NULL, NULL, false),
('OperationMisc', 238, 'OperationType', NULL, NULL, false),
('OperationStiff', 239, 'OperationType', NULL, NULL, false),
('OperationFHol', 240, 'OperationType', NULL, NULL, false),
('OperationDHol', 241, 'OperationType', NULL, NULL, false),
('OperationPathV', 242, 'OperationType', NULL, NULL, false),
('OperationPathS', 243, 'OperationType', NULL, NULL, false),
('OperationPathM', 244, 'OperationType', NULL, NULL, false),
('OperationCope', 245, 'OperationType', NULL, NULL, false),
('OperationMark', 246, 'OperationType', NULL, NULL, false),
('OperationToolTechnology', 247, 'OperationType', NULL, NULL, false),
('OperationBHol', 248, 'OperationType', NULL, NULL, false),
('OperationMSaw', 249, 'OperationType', NULL, NULL, false),
('OperationSense', 250, 'OperationType', NULL, NULL, false),
('Material', 251, 'Material', NULL, NULL, false),
('VertexPathC', 252, 'OperationAdditionalItem', NULL, NULL, false),
('VertexPathS', 253, 'OperationAdditionalItem', NULL, NULL, false),
('VertexPathM', 254, 'OperationAdditionalItem', NULL, NULL, false),	
('OperationSense', 255, 'OperationType', NULL, NULL, false),
('VertexShape', 256, 'OperationAdditionalItem', NULL, NULL, false);
